#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

#include <sys/types.h>

#include <libusb-1.0/libusb.h>

/* constants */
#define ELGATO_VENDOR			0x0fd9
#define GAME_CAPTURE_HD_PID_0	0x0044
#define GAME_CAPTURE_HD_PID_1	0x004e
#define GAME_CAPTURE_HD_PID_2	0x0051

#define EP_OUT			0x02
#define INTERFACE_NUM	0x00
#define CONFIGURATION	0x01

#define DATA_BUF		0x4000

/* global structs */
static struct libusb_device_handle *devh = NULL;

int init_dev_handler() {
	if (libusb_init(NULL)) {
		fprintf(stderr, "Error initializing libusb.");
		return 1;
	}

	libusb_set_debug(NULL, LIBUSB_LOG_LEVEL_DEBUG);

	devh = libusb_open_device_with_vid_pid(NULL, ELGATO_VENDOR, GAME_CAPTURE_HD_PID_0);
	if (devh) {
		return 0;
	}

	devh = libusb_open_device_with_vid_pid(NULL, ELGATO_VENDOR, GAME_CAPTURE_HD_PID_1);
	if (devh) {
		return 0;
	}

	devh = libusb_open_device_with_vid_pid(NULL, ELGATO_VENDOR, GAME_CAPTURE_HD_PID_2);
	if (devh) {
		return 0;
	}

	fprintf(stderr, "Unable to find device.");
	return 1;
}

int get_interface() {
	if (libusb_kernel_driver_active(devh, INTERFACE_NUM)) {
		libusb_detach_kernel_driver(devh, INTERFACE_NUM);
	}

	if (libusb_set_configuration(devh, CONFIGURATION)) {
		fprintf(stderr, "Could not activate configuration.");
		return 1;
	}

	if (libusb_claim_interface(devh, INTERFACE_NUM)) {
		fprintf(stderr, "Failed to claim interface.");
		return 1;
	}

	return 0;
}

void clean_up() {
	if (devh) {
		libusb_release_interface(devh, INTERFACE_NUM);
		libusb_close(devh);
	}

	libusb_exit(NULL);
}

void read_config(uint8_t bRequest, uint16_t wValue, uint16_t wIndex, uint16_t wLength) {
	unsigned char *recv;

	recv = calloc(wLength, sizeof(unsigned char));
	libusb_control_transfer(devh, 0xc0, bRequest, wValue, wIndex, recv, wLength, 0);
	free(recv);
}

void write_config2(uint8_t bRequest, uint16_t wValue, uint16_t wIndex, unsigned char data0, unsigned char data1) {
	unsigned char send[2] = {data0, data1};
	libusb_control_transfer(devh, 0x40, bRequest, wValue, wIndex, send, 2, 0);
}

void write_config5(uint8_t bRequest, uint16_t wValue, uint16_t wIndex, unsigned char data0, unsigned char data1, unsigned char data2, unsigned char data3, unsigned char data4) {
	unsigned char send[5] = {data0, data1, data2, data3, data4};
	libusb_control_transfer(devh, 0x40, bRequest, wValue, wIndex, send, 5, 0);
}

void write_config6(uint8_t bRequest, uint16_t wValue, uint16_t wIndex, unsigned char data0, unsigned char data1, unsigned char data2, unsigned char data3, unsigned char data4, unsigned char data5) {
	unsigned char send[6] = {data0, data1, data2, data3, data4, data5};
	libusb_control_transfer(devh, 0x40, bRequest, wValue, wIndex, send, 6, 0);
}

void write_config8(uint8_t bRequest, uint16_t wValue, uint16_t wIndex, unsigned char data0, unsigned char data1, unsigned char data2, unsigned char data3, unsigned char data4, unsigned char data5, unsigned char data6, unsigned char data7) {
	unsigned char send[8] = {data0, data1, data2, data3, data4, data5, data6, data7};
	libusb_control_transfer(devh, 0x40, bRequest, wValue, wIndex, send, 8, 0);
}

void load_firmware(const char *file) {
	int transfer;

	FILE *bin;
	bin = fopen(file, "rb");

	/* get filesize */
	fseek(bin, 0L, SEEK_END);
	long filesize = ftell(bin);
	rewind(bin);

	/* read firmware from file to buffer and bulk transfer to device */
	for (int i = 0; i <= filesize; i += DATA_BUF) {
		unsigned char data[DATA_BUF] = {0};
		int bytes_remain = filesize - i;

		if ((bytes_remain) > DATA_BUF) {
			bytes_remain = DATA_BUF;
		}

		fread(data, bytes_remain, 1, bin);

		libusb_bulk_transfer(devh, 0x02, data, bytes_remain, &transfer, 0);
	}

	fclose(bin);
}

void configure_dev() {
	read_config(0xbc, 0x0800, 0x0094, 4);
	read_config(0xbc, 0x0800, 0x0098, 4);
	read_config(0xbc, 0x0800, 0x0010, 4);
	read_config(0xbc, 0x0800, 0x0014, 4);
	read_config(0xbc, 0x0800, 0x0018, 4);

	write_config2(0xbc, 0x0900, 0x0000, 0x00, 0x00);

	read_config(0xbc, 0x0900, 0x0014, 2);
	read_config(0xbc, 0x0800, 0x2008, 2);
	read_config(0xbc, 0x0900, 0x0074, 2);
	read_config(0xbc, 0x0900, 0x01b0, 2);
	read_config(0xbc, 0x0800, 0x2008, 2);
	read_config(0xbc, 0x0800, 0x2008, 2);

	/* this is an important step for sending the firmware */
	write_config2(0xbc, 0x0900, 0x0074, 0x00, 0x04);
	write_config2(0xbc, 0x0900, 0x01b0, 0x00, 0x00);

	/* load "idle" firmware */
	load_firmware("firmware/mb86h57_h58_idle.bin");

	// begin of highly (!) experimental part - thank you jedahan!
	write_config2(0xbc, 0x0900, 0x0070, 0x00, 0x04);

	read_config(0xbc, 0x0900, 0x0014, 2);
	read_config(0xbc, 0x0900, 0x0018, 2);
	read_config(0xbc, 0x0000, 0x0010, 2);
	read_config(0xbc, 0x0000, 0x0012, 2);
	read_config(0xbc, 0x0000, 0x0014, 2);
	read_config(0xbc, 0x0000, 0x0016, 2);
	read_config(0xbc, 0x0000, 0x0018, 2);
	read_config(0xbc, 0x0000, 0x001a, 2);
	read_config(0xbc, 0x0000, 0x001c, 2);
	read_config(0xbc, 0x0000, 0x001e, 2);
	read_config(0xbc, 0x0800, 0x2008, 2);

	write_config6(0xb8, 0x0000, 0x0000, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00);

	read_config(0xbc, 0x0800, 0x2008, 2);
	read_config(0xbc, 0x0900, 0x0074, 2);
	read_config(0xbc, 0x0900, 0x01b0, 2);
	read_config(0xbc, 0x0800, 0x2008, 2);
	read_config(0xbc, 0x0800, 0x2008, 2);

	write_config2(0xbc, 0x0900, 0x0074, 0x00, 0x04);
	write_config2(0xbc, 0x0900, 0x01b0, 0x00, 0x00);
	write_config5(0xbd, 0x0000, 0x3300, 0xab, 0xa9, 0x0f, 0xa4, 0x55);
	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x00);

	read_config(0xbc, 0x0900, 0x001c, 2);
	read_config(0xbd, 0x0000, 0x3300, 3);

	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x00);

	read_config(0xbc, 0x0900, 0x001c, 2);

	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x04);
	write_config2(0xbc, 0x0900, 0x0018, 0x00, 0x00);

	read_config(0xbc, 0x0900, 0x0014, 2);
	read_config(0xbc, 0x0900, 0x0018, 2);

	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x06);
	write_config2(0xbc, 0x0900, 0x0018, 0x00, 0x02);

	read_config(0xbc, 0x0900, 0x0014, 2);
	read_config(0xbc, 0x0900, 0x0018, 2);

	write_config5(0xbd, 0x0000, 0x3300, 0xab, 0xa9, 0x0f, 0xa4, 0x55);
	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x06);

	read_config(0xbc, 0x0900, 0x001c, 2);
	read_config(0xbd, 0x0000, 0x3300, 3);

	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x02);

	read_config(0xbc, 0x0900, 0x001c, 2);

	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x06);
	write_config2(0xbc, 0x0900, 0x0018, 0x00, 0x02);

	read_config(0xbc, 0x0900, 0x0014, 2);
	read_config(0xbc, 0x0900, 0x0018, 2);

	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x06);
	write_config2(0xbc, 0x0900, 0x0018, 0x00, 0x02);

	read_config(0xbc, 0x0900, 0x0014, 2);
	read_config(0xbc, 0x0900, 0x0018, 2);

	write_config5(0xbd, 0x0000, 0x3300, 0xab, 0xa9, 0x0f, 0xa4, 0x55);
	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x06);

	read_config(0xbc, 0x0900, 0x001c, 2);
	read_config(0xbd, 0x0000, 0x3300, 3);

	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x02);

	read_config(0xbc, 0x0900, 0x001c, 2);

	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x06);
	write_config2(0xbc, 0x0900, 0x0018, 0x00, 0x02);

	read_config(0xbc, 0x0900, 0x0014, 2);
	read_config(0xbc, 0x0900, 0x0018, 2);

	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x06);
	write_config2(0xbc, 0x0900, 0x0018, 0x00, 0x02);

	read_config(0xbc, 0x0900, 0x0014, 2);
	read_config(0xbc, 0x0900, 0x0018, 2);

	write_config5(0xbd, 0x0000, 0x3300, 0xab, 0xa9, 0x0f, 0xa4, 0x55);
	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x06);

	read_config(0xbc, 0x0900, 0x001c, 2);
	read_config(0xbd, 0x0000, 0x3300, 3);

	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x02);

	read_config(0xbc, 0x0900, 0x001c, 2);

	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x06);
	write_config2(0xbc, 0x0900, 0x0018, 0x00, 0x02);

	read_config(0xbc, 0x0900, 0x0014, 2);
	read_config(0xbc, 0x0900, 0x0018, 2);

	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x06);
	write_config2(0xbc, 0x0900, 0x0018, 0x00, 0x02);

	read_config(0xbc, 0x0900, 0x0014, 2);
	read_config(0xbc, 0x0900, 0x0018, 2);

	write_config5(0xbd, 0x0000, 0x3300, 0xab, 0xa9, 0x0f, 0xa4, 0x55);
	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x06);

	read_config(0xbc, 0x0900, 0x001c, 2);
	read_config(0xbd, 0x0000, 0x3300, 3);

	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x02);

	read_config(0xbc, 0x0900, 0x001c, 2);

	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x06);
	write_config2(0xbc, 0x0900, 0x0018, 0x00, 0x02);

	read_config(0xbc, 0x0900, 0x0014, 2);
	read_config(0xbc, 0x0900, 0x0018, 2);

	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x06);
	write_config2(0xbc, 0x0900, 0x0018, 0x00, 0x02);

	read_config(0xbc, 0x0900, 0x0014, 2);
	read_config(0xbc, 0x0900, 0x0018, 2);

	write_config5(0xbd, 0x0000, 0x3300, 0xab, 0xa9, 0x0f, 0xa4, 0x55);
	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x06);

	read_config(0xbc, 0x0900, 0x001c, 2);
	read_config(0xbd, 0x0000, 0x3300, 3);

	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x02);

	read_config(0xbc, 0x0900, 0x001c, 2);

	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x06);
	write_config2(0xbc, 0x0900, 0x0018, 0x00, 0x02);

	read_config(0xbc, 0x0900, 0x0014, 2);
	read_config(0xbc, 0x0900, 0x0018, 2);

	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x06);
	write_config2(0xbc, 0x0900, 0x0018, 0x00, 0x02);

	read_config(0xbc, 0x0900, 0x0014, 2);
	read_config(0xbc, 0x0900, 0x0018, 2);

	write_config5(0xbd, 0x0000, 0x3300, 0xab, 0xa9, 0x0f, 0xa4, 0x55);
	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x06);

	read_config(0xbc, 0x0900, 0x001c, 2);
	read_config(0xbd, 0x0000, 0x3300, 3);

	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x02);

	read_config(0xbc, 0x0900, 0x001c, 2);

	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x06);
	write_config2(0xbc, 0x0900, 0x0018, 0x00, 0x02);

	read_config(0xbc, 0x0900, 0x0014, 2);
	read_config(0xbc, 0x0900, 0x0018, 2);

	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x06);
	write_config2(0xbc, 0x0900, 0x0018, 0x00, 0x02);

	read_config(0xbc, 0x0900, 0x0014, 2);
	read_config(0xbc, 0x0900, 0x0018, 2);

	write_config5(0xbd, 0x0000, 0x3300, 0xab, 0xa9, 0x0f, 0xa4, 0x55);
	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x06);

	read_config(0xbc, 0x0900, 0x001c, 2);
	read_config(0xbd, 0x0000, 0x3300, 3);

	write_config2(0xbc, 0x0900, 0x0014, 0x00, 0x06);
	write_config2(0xbc, 0x0900, 0x0018, 0x00, 0x02);

	read_config(0xbc, 0x0900, 0x0014, 2);
	read_config(0xbc, 0x0900, 0x0018, 2);

	write_config2(0xbc, 0x0900, 0x0000, 0x00, 0x00);

	write_config8(0xbc, 0x0001, 0x1000, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02);
	write_config8(0xbc, 0x0001, 0x1000, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x10);
	write_config8(0xbc, 0x0001, 0x1004, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x1004, 0x00, 0x00, 0x00, 0x00, 0x60, 0x00, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x1004, 0x00, 0x00, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x1004, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x1004, 0x01, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x1004, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x1004, 0x00, 0x04, 0x00, 0x00, 0x00, 0x7f, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x1004, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00);
	write_config8(0xbc, 0x0001, 0x1004, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00);
	write_config8(0xbc, 0x0001, 0x1004, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80);
	write_config8(0xbc, 0x0001, 0x1100, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04);
	write_config8(0xbc, 0x0001, 0x1240, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04);
	write_config8(0xbc, 0x0001, 0x1100, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x03);
	write_config8(0xbc, 0x0001, 0x1240, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x03);
	write_config8(0xbc, 0x0001, 0x1104, 0x61, 0xa8, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x1244, 0x1f, 0x40, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x1104, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff);
	write_config8(0xbc, 0x0001, 0x1244, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff);
	write_config8(0xbc, 0x0001, 0x1108, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x1108, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff);
	write_config8(0xbc, 0x0001, 0x1248, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x1248, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff);
	write_config8(0xbc, 0x0001, 0x110c, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x110c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff);
	write_config8(0xbc, 0x0001, 0x1110, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x1110, 0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x124c, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x124c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff);
	write_config8(0xbc, 0x0001, 0x1250, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x1250, 0x00, 0x00, 0x00, 0x00, 0x01, 0xff, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x1124, 0x00, 0x00, 0x10, 0x11, 0x00, 0x00, 0x1f, 0xff);
	write_config8(0xbc, 0x0001, 0x1264, 0x00, 0x00, 0x10, 0x11, 0x00, 0x00, 0x1f, 0xff);
	write_config8(0xbc, 0x0001, 0x1128, 0x01, 0x0f, 0x00, 0x00, 0x1f, 0xff, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x1268, 0x01, 0x0f, 0x00, 0x00, 0x1f, 0xff, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x1134, 0x00, 0x1f, 0x00, 0x00, 0x1f, 0xff, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x1274, 0x00, 0x1f, 0x00, 0x00, 0x1f, 0xff, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x112c, 0x01, 0x10, 0x00, 0x00, 0x1f, 0xff, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x126c, 0x01, 0x10, 0x00, 0x00, 0x1f, 0xff, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x112c, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x1f, 0xff);
	write_config8(0xbc, 0x0001, 0x126c, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x1f, 0xff);
	write_config8(0xbc, 0x0001, 0x1268, 0x00, 0x00, 0x11, 0x11, 0x00, 0x00, 0x1f, 0xff);
	write_config8(0xbc, 0x0001, 0x1130, 0x00, 0xe0, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x1270, 0x00, 0xe0, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x113c, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x127c, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x113c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff);
	write_config8(0xbc, 0x0001, 0x127c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff);
	write_config8(0xbc, 0x0001, 0x1140, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x1280, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00);
	write_config8(0xbc, 0x0001, 0x1140, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xff);
	write_config8(0xbc, 0x0001, 0x1280, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xff);
	write_config8(0xbc, 0x0001, 0x1138, 0x10, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00);

	unsigned char snd0182[2] = {0x00, 0xb0};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1144, snd0182, 2, 0);

	unsigned char snd0183[2] = {0x11, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1146, snd0183, 2, 0);

	unsigned char snd0184[2] = {0x00, 0xc1};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1148, snd0184, 2, 0);

	unsigned char snd0185[2] = {0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x114a, snd0185, 2, 0);

	unsigned char snd0186[2] = {0x00, 0x01};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x114c, snd0186, 2, 0);

	unsigned char snd0187[2] = {0xe1, 0x10};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x114e, snd0187, 2, 0);

	unsigned char snd0188[2] = {0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1150, snd0188, 2, 0);

	unsigned char snd0189[2] = {0xe0, 0x1f};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1152, snd0189, 2, 0);

	unsigned char snd0190[8] = {0x10, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1278, snd0190, 8, 0);

	unsigned char snd0191[2] = {0x00, 0xb0};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1284, snd0191, 2, 0);

	unsigned char snd0192[2] = {0x11, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1286, snd0192, 2, 0);

	unsigned char snd0193[2] = {0x00, 0xc1};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1288, snd0193, 2, 0);

	unsigned char snd0194[2] = {0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x128a, snd0194, 2, 0);

	unsigned char snd0195[2] = {0x00, 0x01};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x128c, snd0195, 2, 0);

	unsigned char snd0196[2] = {0xe1, 0x10};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x128e, snd0196, 2, 0);

	unsigned char snd0197[2] = {0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1290, snd0197, 2, 0);

	unsigned char snd0198[2] = {0xe0, 0x1f};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1292, snd0198, 2, 0);

	unsigned char snd0199[8] = {0x00, 0x00, 0x0a, 0x00, 0x00, 0x00, 0xff, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x113c, snd0199, 8, 0);

	unsigned char snd0200[2] = {0x7f, 0xf0};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1010, snd0200, 2, 0);

	unsigned char snd0201[2] = {0x0b, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1012, snd0201, 2, 0);

	unsigned char snd0202[2] = {0xff, 0xc1};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1014, snd0202, 2, 0);

	unsigned char snd0203[2] = {0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1016, snd0203, 2, 0);

	unsigned char snd0204[2] = {0xf0, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1018, snd0204, 2, 0);

	unsigned char snd0205[8] = {0x00, 0x00, 0x0a, 0x00, 0x00, 0x00, 0xff, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x127c, snd0205, 8, 0);

	unsigned char snd0206[2] = {0x7f, 0xf0};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1370, snd0206, 2, 0);

	unsigned char snd0207[2] = {0x0b, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1372, snd0207, 2, 0);

	unsigned char snd0208[2] = {0xff, 0xc1};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1374, snd0208, 2, 0);

	unsigned char snd0209[2] = {0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1376, snd0209, 2, 0);

	unsigned char snd0210[2] = {0xf0, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1378, snd0210, 2, 0);

	unsigned char snd0211[8] = {0x00, 0x20, 0x00, 0x00, 0x00, 0xf0, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x100c, snd0211, 8, 0);

	unsigned char snd0212[8] = {0x00, 0x02, 0x00, 0x00, 0x00, 0x0f, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x100c, snd0212, 8, 0);

	unsigned char snd0213[8] = {0x30, 0x00, 0x00, 0x00, 0xf0, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x100c, snd0213, 8, 0);

	unsigned char snd0214[8] = {0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1130, snd0214, 8, 0);

	unsigned char snd0215[8] = {0x00, 0x36, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1138, snd0215, 8, 0);

	unsigned char snd0216[2] = {0x37, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1176, snd0216, 2, 0);

	unsigned char snd0217[2] = {0xff, 0x03};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x11a4, snd0217, 2, 0);

	unsigned char snd0218[2] = {0xe1, 0x0f};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x11a6, snd0218, 2, 0);

	unsigned char snd0219[2] = {0xf0, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x11a8, snd0219, 2, 0);

	unsigned char snd0220[2] = {0x02, 0xb0};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1174, snd0220, 2, 0);

	unsigned char snd0221[2] = {0x01, 0xc1};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1178, snd0221, 2, 0);

	unsigned char snd0222[2] = {0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x117a, snd0222, 2, 0);

	unsigned char snd0223[2] = {0xe1, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x117c, snd0223, 2, 0);

	unsigned char snd0224[2] = {0xf0, 0x0c};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x117e, snd0224, 2, 0);

	unsigned char snd0225[2] = {0x05, 0x04};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1180, snd0225, 2, 0);

	unsigned char snd0226[2] = {0x48, 0x44};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1182, snd0226, 2, 0);

	unsigned char snd0227[2] = {0x4d, 0x56};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1184, snd0227, 2, 0);

	unsigned char snd0228[2] = {0x88, 0x04};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1186, snd0228, 2, 0);

	unsigned char snd0229[2] = {0x0f, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1188, snd0229, 2, 0);

	unsigned char snd0230[2] = {0xfc, 0xfc};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x118a, snd0230, 2, 0);

	unsigned char snd0231[2] = {0x1b, 0xf0};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x118c, snd0231, 2, 0);

	unsigned char snd0232[2] = {0x11, 0xf0};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x118e, snd0232, 2, 0);

	unsigned char snd0233[2] = {0x14, 0x05};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1190, snd0233, 2, 0);

	unsigned char snd0234[2] = {0x08, 0x48};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1192, snd0234, 2, 0);

	unsigned char snd0235[2] = {0x44, 0x4d};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1194, snd0235, 2, 0);

	unsigned char snd0236[2] = {0x56, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1196, snd0236, 2, 0);

	unsigned char snd0237[2] = {0x1b, 0x44};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1198, snd0237, 2, 0);

	unsigned char snd0238[2] = {0x3f, 0x28};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x119a, snd0238, 2, 0);

	unsigned char snd0239[2] = {0x04, 0x64};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x119c, snd0239, 2, 0);

	unsigned char snd0240[2] = {0x00, 0x28};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x119e, snd0240, 2, 0);

	unsigned char snd0241[2] = {0x3f, 0x2a};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x11a0, snd0241, 2, 0);

	unsigned char snd0242[2] = {0x02, 0x7e};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x11a2, snd0242, 2, 0);

	unsigned char snd0243[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x0f, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x100c, snd0243, 8, 0);

	unsigned char snd0244[8] = {0x00, 0x00, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x100c, snd0244, 8, 0);

	unsigned char snd0245[8] = {0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1270, snd0245, 8, 0);

	unsigned char snd0246[8] = {0x00, 0x36, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1278, snd0246, 8, 0);

	unsigned char snd0247[2] = {0x37, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12b6, snd0247, 2, 0);

	unsigned char snd0248[2] = {0xff, 0x03};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12e4, snd0248, 2, 0);

	unsigned char snd0249[2] = {0xe1, 0x0f};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12e6, snd0249, 2, 0);

	unsigned char snd0250[2] = {0xf0, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12e8, snd0250, 2, 0);

	unsigned char snd0251[2] = {0x02, 0xb0};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12b4, snd0251, 2, 0);

	unsigned char snd0252[2] = {0x01, 0xc1};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12b8, snd0252, 2, 0);

	unsigned char snd0253[2] = {0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12ba, snd0253, 2, 0);

	unsigned char snd0254[2] = {0xe1, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12bc, snd0254, 2, 0);

	unsigned char snd0255[2] = {0xf0, 0x0c};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12be, snd0255, 2, 0);

	unsigned char snd0256[2] = {0x05, 0x04};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12c0, snd0256, 2, 0);

	unsigned char snd0257[2] = {0x48, 0x44};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12c2, snd0257, 2, 0);

	unsigned char snd0258[2] = {0x4d, 0x56};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12c4, snd0258, 2, 0);

	unsigned char snd0259[2] = {0x88, 0x04};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12c6, snd0259, 2, 0);

	unsigned char snd0260[2] = {0x0f, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12c8, snd0260, 2, 0);

	unsigned char snd0261[2] = {0xfc, 0xfc};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12ca, snd0261, 2, 0);

	unsigned char snd0262[2] = {0x1b, 0xf0};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12cc, snd0262, 2, 0);

	unsigned char snd0263[2] = {0x11, 0xf0};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12ce, snd0263, 2, 0);

	unsigned char snd0264[2] = {0x14, 0x05};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12d0, snd0264, 2, 0);

	unsigned char snd0265[2] = {0x08, 0x48};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12d2, snd0265, 2, 0);

	unsigned char snd0266[2] = {0x44, 0x4d};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12d4, snd0266, 2, 0);

	unsigned char snd0267[2] = {0x56, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12d6, snd0267, 2, 0);

	unsigned char snd0268[2] = {0x1b, 0x44};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12d8, snd0268, 2, 0);

	unsigned char snd0269[2] = {0x3f, 0x28};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12da, snd0269, 2, 0);

	unsigned char snd0270[2] = {0x04, 0x64};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12dc, snd0270, 2, 0);

	unsigned char snd0271[2] = {0x00, 0x28};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12de, snd0271, 2, 0);

	unsigned char snd0272[2] = {0x3f, 0x2a};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12e0, snd0272, 2, 0);

	unsigned char snd0273[2] = {0x02, 0x7e};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x12e2, snd0273, 2, 0);

	unsigned char snd0274[8] = {0x10, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1710, snd0274, 8, 0);

	unsigned char snd0275[2] = {0x00, 0xfc};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1710, snd0275, 2, 0);

	unsigned char snd0276[2] = {0x00, 0x24};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1712, snd0276, 2, 0);

	unsigned char snd0277[2] = {0x00, 0xf8};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1714, snd0277, 2, 0);

	unsigned char snd0278[2] = {0x00, 0xe8};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1716, snd0278, 2, 0);

	unsigned char snd0279[2] = {0x00, 0xda};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x1718, snd0279, 2, 0);

	unsigned char snd0280[2] = {0x00, 0xc6};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x171a, snd0280, 2, 0);

	unsigned char snd0281[2] = {0x00, 0x76};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x171c, snd0281, 2, 0);

	unsigned char snd0282[2] = {0x00, 0xea};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0000, 0x171e, snd0282, 2, 0);

	unsigned char snd0283[8] = {0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x04, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1500, snd0283, 8, 0);

	unsigned char snd0284[8] = {0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1500, snd0284, 8, 0);

	unsigned char snd0285[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1510, snd0285, 8, 0);

	unsigned char snd0286[8] = {0x00, 0x02, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1504, snd0286, 8, 0);

	unsigned char snd0287[8] = {0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1510, snd0287, 8, 0);

	unsigned char snd0288[8] = {0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1610, snd0288, 8, 0);

	unsigned char snd0289[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1510, snd0289, 8, 0);

	unsigned char snd0290[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1610, snd0290, 8, 0);

	unsigned char snd0291[8] = {0x00, 0x10, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1510, snd0291, 8, 0);

	unsigned char snd0292[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1510, snd0292, 8, 0);

	unsigned char snd0293[8] = {0x00, 0x08, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1610, snd0293, 8, 0);

	unsigned char snd0294[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1510, snd0294, 8, 0);

	unsigned char snd0295[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1610, snd0295, 8, 0);

	unsigned char snd0296[8] = {0x00, 0x01, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1510, snd0296, 8, 0);

	unsigned char snd0297[8] = {0x00, 0x01, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1610, snd0297, 8, 0);

	unsigned char snd0298[8] = {0x0f, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1518, snd0298, 8, 0);

	unsigned char snd0299[8] = {0x0f, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1618, snd0299, 8, 0);

	unsigned char snd0300[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1518, snd0300, 8, 0);

	unsigned char snd0301[8] = {0x00, 0x01, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1618, snd0301, 8, 0);

	unsigned char snd0302[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1518, snd0302, 8, 0);

	unsigned char snd0303[8] = {0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x151c, snd0303, 8, 0);

	unsigned char snd0304[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1618, snd0304, 8, 0);

	unsigned char snd0305[8] = {0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x161c, snd0305, 8, 0);

	unsigned char snd0306[8] = {0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0xff, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1524, snd0306, 8, 0);

	unsigned char snd0307[8] = {0x00, 0x00, 0x00, 0x29, 0x00, 0x00, 0x00, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1524, snd0307, 8, 0);

	unsigned char snd0308[8] = {0x02, 0xd0, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x152c, snd0308, 8, 0);

	unsigned char snd0309[8] = {0x00, 0x00, 0x01, 0xe0, 0x00, 0x00, 0xff, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x152c, snd0309, 8, 0);

	unsigned char snd0310[8] = {0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0xff, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1624, snd0310, 8, 0);

	unsigned char snd0311[8] = {0x00, 0x00, 0x00, 0x0c, 0x00, 0x00, 0x00, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1624, snd0311, 8, 0);

	unsigned char snd0312[8] = {0x01, 0x40, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x162c, snd0312, 8, 0);

	unsigned char snd0313[8] = {0x00, 0x00, 0x00, 0xf0, 0x00, 0x00, 0xff, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x162c, snd0313, 8, 0);

	unsigned char snd0314[8] = {0x00, 0x00, 0x3e, 0x80, 0x00, 0x00, 0xff, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1530, snd0314, 8, 0);

	unsigned char snd0315[8] = {0x36, 0xb0, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1534, snd0315, 8, 0);

	unsigned char snd0316[8] = {0x00, 0x00, 0x1f, 0x40, 0x00, 0x00, 0xff, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1534, snd0316, 8, 0);

	unsigned char snd0317[8] = {0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1538, snd0317, 8, 0);

	unsigned char snd0318[8] = {0x00, 0x00, 0x27, 0x10, 0x00, 0x00, 0xff, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1630, snd0318, 8, 0);

	unsigned char snd0319[8] = {0x17, 0x70, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1634, snd0319, 8, 0);

	unsigned char snd0320[8] = {0x00, 0x00, 0x07, 0x08, 0x00, 0x00, 0xff, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1634, snd0320, 8, 0);

	unsigned char snd0321[8] = {0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1638, snd0321, 8, 0);

	unsigned char snd0322[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1550, snd0322, 8, 0);

	unsigned char snd0323[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1550, snd0323, 8, 0);

	unsigned char snd0324[8] = {0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1554, snd0324, 8, 0);

	unsigned char snd0325[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1554, snd0325, 8, 0);

	unsigned char snd0326[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1554, snd0326, 8, 0);

	unsigned char snd0327[8] = {0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1558, snd0327, 8, 0);

	unsigned char snd0328[8] = {0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1570, snd0328, 8, 0);

	unsigned char snd0329[8] = {0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1670, snd0329, 8, 0);

	unsigned char snd0330[8] = {0x40, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1570, snd0330, 8, 0);

	unsigned char snd0331[8] = {0x40, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1670, snd0331, 8, 0);

	unsigned char snd0332[8] = {0x08, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1570, snd0332, 8, 0);

	unsigned char snd0333[8] = {0x08, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1670, snd0333, 8, 0);

	unsigned char snd0334[8] = {0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x157c, snd0334, 8, 0);

	unsigned char snd0335[8] = {0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x167c, snd0335, 8, 0);

	unsigned char snd0336[8] = {0x40, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x157c, snd0336, 8, 0);

	unsigned char snd0337[8] = {0x40, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x167c, snd0337, 8, 0);

	unsigned char snd0338[8] = {0x08, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x157c, snd0338, 8, 0);

	unsigned char snd0339[8] = {0x08, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x167c, snd0339, 8, 0);

	unsigned char snd0340[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x157c, snd0340, 8, 0);

	unsigned char snd0341[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x167c, snd0341, 8, 0);

	unsigned char snd0342[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x157c, snd0342, 8, 0);

	unsigned char snd0343[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x167c, snd0343, 8, 0);

	unsigned char snd0344[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x157c, snd0344, 8, 0);

	unsigned char snd0345[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x167c, snd0345, 8, 0);

	unsigned char snd0346[8] = {0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1580, snd0346, 8, 0);

	unsigned char snd0347[8] = {0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1680, snd0347, 8, 0);

	unsigned char snd0348[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1580, snd0348, 8, 0);

	unsigned char snd0349[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1680, snd0349, 8, 0);

	unsigned char snd0350[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1580, snd0350, 8, 0);

	unsigned char snd0351[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1680, snd0351, 8, 0);

	unsigned char snd0352[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1580, snd0352, 8, 0);

	unsigned char snd0353[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1680, snd0353, 8, 0);

	unsigned char snd0354[8] = {0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1684, snd0354, 8, 0);

	unsigned char snd0355[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1684, snd0355, 8, 0);

	unsigned char snd0356[8] = {0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1688, snd0356, 8, 0);

	unsigned char snd0357[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a00, snd0357, 8, 0);

	unsigned char snd0358[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a08, snd0358, 8, 0);

	unsigned char snd0359[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a08, snd0359, 8, 0);

	unsigned char snd0360[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a08, snd0360, 8, 0);

	unsigned char snd0361[8] = {0x00, 0x08, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a08, snd0361, 8, 0);

	unsigned char snd0362[8] = {0x00, 0x20, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a08, snd0362, 8, 0);

	unsigned char snd0363[8] = {0x00, 0x40, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a08, snd0363, 8, 0);

	unsigned char snd0364[8] = {0x00, 0x80, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a08, snd0364, 8, 0);

	unsigned char snd0365[8] = {0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a08, snd0365, 8, 0);

	unsigned char snd0366[8] = {0x00, 0x00, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a08, snd0366, 8, 0);

	unsigned char snd0367[8] = {0x00, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a08, snd0367, 8, 0);

	unsigned char snd0368[8] = {0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a08, snd0368, 8, 0);

	unsigned char snd0369[8] = {0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a08, snd0369, 8, 0);

	unsigned char snd0370[8] = {0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a0c, snd0370, 8, 0);

	unsigned char snd0371[8] = {0x80, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a64, snd0371, 8, 0);

	unsigned char snd0372[8] = {0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0xff, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a64, snd0372, 8, 0);

	unsigned char snd0373[8] = {0x80, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a68, snd0373, 8, 0);

	unsigned char snd0374[8] = {0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0xff, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a68, snd0374, 8, 0);

	unsigned char snd0375[8] = {0x80, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a6c, snd0375, 8, 0);

	unsigned char snd0376[8] = {0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0xff, 0xff};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a6c, snd0376, 8, 0);

	unsigned char snd0377[8] = {0x01, 0x80, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a04, snd0377, 8, 0);

	unsigned char snd0378[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a14, snd0378, 8, 0);

	unsigned char snd0379[8] = {0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x10};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a14, snd0379, 8, 0);

	unsigned char snd0380[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x08};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a14, snd0380, 8, 0);

	unsigned char snd0381[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a14, snd0381, 8, 0);

	unsigned char snd0382[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a14, snd0382, 8, 0);

	unsigned char snd0383[8] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01};
	libusb_control_transfer(devh, 0x40, 0xbc, 0x0001, 0x1a04, snd0383, 8, 0);

	unsigned char snd0384[6] = {0x00, 0x00, 0x04, 0x00, 0x00, 0x00};
	libusb_control_transfer(devh, 0x40, 0xb8, 0x0000, 0x0000, snd0384, 6, 0);
	// end of highly experimental part

	/* load "enc" firmware */
	load_firmware("firmware/mb86h57_h58_enc_h.bin");
}

void receive_data() {
	int transfer;
	unsigned char data[DATA_BUF] = {0};

	libusb_bulk_transfer(devh, 0x84, data, DATA_BUF, &transfer, 0);
	printf("%d bytes received\n", transfer);

	for (int i = 0; i < DATA_BUF; i++) {
		printf("%x ", data[i]);
	}

	printf("\n");
}

int main() {
	/* initialize device handler */
	if (init_dev_handler()) {
		goto end;
	}

	/* detach kernel driver and claim interface */
	if (get_interface()) {
		goto end;
	}

	/* configure device */
	configure_dev();

	while(1) {
		receive_data();
	}

end:
	/* clean up */
	clean_up();

	return 0;
}
